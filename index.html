<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Life Tracker - Habits</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <nav class="main-nav">
        <div class="nav-brand">ğŸ¯ Life Tracker</div>
        <div class="nav-links">
            <a href="dashboard.html">Dashboard</a>
            <a href="index.html" class="active">Habits</a>
            <a href="sleep.html">Sleep</a>
            <a href="diet.html">Diet</a>
            <a href="work.html">Work</a>
            <a href="mood.html">Mood</a>
            <a href="hydration.html">Water</a>
            <button id="themeToggle" onclick="toggleTheme()">â˜€ï¸</button>
        </div>
    </nav>

    <div class="container">
        <h1>ğŸ“‹ Daily Habits</h1>
        
        <div class="date-nav">
            <button onclick="changeDate(-1)">â† Previous</button>
            <span class="current-date" id="currentDate"></span>
            <button onclick="changeDate(1)">Next â†’</button>
        </div>

        <div class="section">
            <h2>Today's Habits</h2>
            <div class="habits-grid" id="habitsGrid"></div>
            <button class="add-btn" onclick="openModal()">
                <span>+</span> Add New Habit
            </button>
        </div>

        <div class="section">
            <h2>ğŸ“… Calendar View</h2>
            <div class="month-nav">
                <button onclick="changeMonth(-1)">â† Prev</button>
                <h3 id="calendarMonth"></h3>
                <button onclick="changeMonth(1)">Next â†’</button>
            </div>
            <div class="calendar-grid" id="calendarGrid"></div>
        </div>

        <div class="section">
            <h2>ğŸ“Š Monthly Statistics</h2>
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-value" id="totalCompleted">0</div>
                    <div class="stat-label">Habits Completed</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="totalPossible">0</div>
                    <div class="stat-label">Total Possible</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="currentStreak">0</div>
                    <div class="stat-label">Current Streak</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="perfectDays">0</div>
                    <div class="stat-label">Perfect Days</div>
                </div>
            </div>

            <div class="progress-container">
                <div class="progress-header">
                    <span>Overall Monthly Progress</span>
                    <span id="progressPercent">0%</span>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill" style="width: 0%"></div>
                </div>
            </div>

            <div class="chart-container" style="margin-top: 30px;">
                <div class="pie-chart" id="pieChart">
                    <div class="pie-center">
                        <span class="pie-percentage" id="piePercent">0%</span>
                        <span class="pie-label">Achievement</span>
                    </div>
                </div>
                <div class="chart-legend">
                    <div class="legend-item">
                        <div class="legend-color completed"></div>
                        <span>Completed</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color missed"></div>
                        <span>Missed</span>
                    </div>
                </div>
            </div>
        </div>

        <div class="section">
            <h2>ğŸ“ˆ Per-Habit Progress This Month</h2>
            <div class="habit-progress-list" id="habitProgressList"></div>
        </div>
    </div>

    <!-- Add/Edit Habit Modal -->
    <div class="modal-overlay" id="modalOverlay">
        <div class="modal">
            <h2 id="modalTitle">Add New Habit</h2>
            <div class="form-group">
                <label for="habitName">Habit Name</label>
                <input type="text" id="habitName" placeholder="e.g., 200 Push-ups">
            </div>
            <div class="form-group">
                <label for="habitDescription">Description (optional)</label>
                <input type="text" id="habitDescription" placeholder="e.g., Morning workout">
            </div>
            <div class="form-group">
                <label for="habitIcon">Icon</label>
                <select id="habitIcon">
                    <option value="ğŸ’ª">ğŸ’ª Strength</option>
                    <option value="ğŸƒ">ğŸƒ Running</option>
                    <option value="ğŸ‹ï¸">ğŸ‹ï¸ Gym</option>
                    <option value="ğŸ˜´">ğŸ˜´ Sleep</option>
                    <option value="ğŸ“±">ğŸ“± Phone</option>
                    <option value="ğŸ¥—">ğŸ¥— Food</option>
                    <option value="ğŸ’§">ğŸ’§ Water</option>
                    <option value="ğŸ“š">ğŸ“š Reading</option>
                    <option value="ğŸ§˜">ğŸ§˜ Meditation</option>
                    <option value="âœ…">âœ… Task</option>
                    <option value="ğŸ¯">ğŸ¯ Goal</option>
                    <option value="â°">â° Time</option>
                    <option value="ğŸ’¼">ğŸ’¼ Business</option>
                    <option value="ğŸ’°">ğŸ’° Money</option>
                </select>
            </div>
            <div class="modal-buttons">
                <button class="btn-delete" id="deleteBtn" onclick="deleteHabit()" style="display: none;">Delete</button>
                <button class="btn-cancel" onclick="closeModal()">Cancel</button>
                <button class="btn-save" onclick="saveHabit()">Save</button>
            </div>
        </div>
    </div>

    <script src="shared.js"></script>
    <script>
        // State
        let habits = JSON.parse(localStorage.getItem('habits')) || [
            { id: 1, name: '200 Push-ups', description: 'Morning workout', icon: 'ğŸ’ª' },
            { id: 2, name: '100 Pull-ups', description: 'Upper body strength', icon: 'ğŸ‹ï¸' },
            { id: 3, name: 'Sleep at 22:00', description: 'Bedtime routine', icon: 'ğŸ˜´' },
            { id: 4, name: 'Wake at 6:00', description: 'Early bird', icon: 'â°' },
            { id: 5, name: 'Phone < 3 hours', description: 'Screen time limit', icon: 'ğŸ“±' },
            { id: 6, name: 'Calorie target', description: 'Nutrition goals', icon: 'ğŸ¥—' },
            { id: 7, name: 'Go to gym', description: 'Daily workout', icon: 'ğŸƒ' },
            { id: 8, name: '1 Hour Business', description: 'Build your business', icon: 'ğŸ’¼' }
        ];
        
        let completions = JSON.parse(localStorage.getItem('completions')) || {};
        let selectedDate = new Date();
        let calendarMonth = new Date();
        let editingHabitId = null;

        function init() {
            renderDate();
            renderHabits();
            renderCalendar();
            updateStats();
        }

        function changeDate(delta) {
            selectedDate.setDate(selectedDate.getDate() + delta);
            renderDate();
            renderHabits();
            updateStats();
        }

        function renderDate() {
            document.getElementById('currentDate').textContent = formatDisplayDate(selectedDate);
        }

        function renderHabits() {
            const grid = document.getElementById('habitsGrid');
            const dateKey = formatDate(selectedDate);
            
            grid.innerHTML = habits.map(habit => {
                const isCompleted = completions[dateKey]?.includes(habit.id);
                return `
                    <div class="habit-card ${isCompleted ? 'completed' : ''}" 
                         onclick="toggleHabit(${habit.id})"
                         oncontextmenu="editHabit(event, ${habit.id})">
                        <div class="habit-checkbox"></div>
                        <div class="habit-info">
                            <h3>${habit.name}</h3>
                            <p>${habit.description}</p>
                        </div>
                        <span class="habit-icon">${habit.icon}</span>
                    </div>
                `;
            }).join('');
        }

        function toggleHabit(habitId) {
            const dateKey = formatDate(selectedDate);
            
            if (!completions[dateKey]) {
                completions[dateKey] = [];
            }
            
            const index = completions[dateKey].indexOf(habitId);
            if (index > -1) {
                completions[dateKey].splice(index, 1);
            } else {
                completions[dateKey].push(habitId);
            }
            
            saveData();
            renderHabits();
            renderCalendar();
            updateStats();
        }

        function openModal(habitId = null) {
            editingHabitId = habitId;
            const modal = document.getElementById('modalOverlay');
            const title = document.getElementById('modalTitle');
            const deleteBtn = document.getElementById('deleteBtn');
            
            if (habitId) {
                const habit = habits.find(h => h.id === habitId);
                document.getElementById('habitName').value = habit.name;
                document.getElementById('habitDescription').value = habit.description;
                document.getElementById('habitIcon').value = habit.icon;
                title.textContent = 'Edit Habit';
                deleteBtn.style.display = 'block';
            } else {
                document.getElementById('habitName').value = '';
                document.getElementById('habitDescription').value = '';
                document.getElementById('habitIcon').value = 'ğŸ’ª';
                title.textContent = 'Add New Habit';
                deleteBtn.style.display = 'none';
            }
            
            modal.classList.add('active');
        }

        function closeModal() {
            document.getElementById('modalOverlay').classList.remove('active');
            editingHabitId = null;
        }

        function saveHabit() {
            const name = document.getElementById('habitName').value.trim();
            const description = document.getElementById('habitDescription').value.trim();
            const icon = document.getElementById('habitIcon').value;
            
            if (!name) {
                alert('Please enter a habit name');
                return;
            }
            
            if (editingHabitId) {
                const habit = habits.find(h => h.id === editingHabitId);
                habit.name = name;
                habit.description = description;
                habit.icon = icon;
            } else {
                const newId = Math.max(...habits.map(h => h.id), 0) + 1;
                habits.push({ id: newId, name, description, icon });
            }
            
            saveData();
            closeModal();
            renderHabits();
            renderCalendar();
            updateStats();
        }

        function deleteHabit() {
            if (confirm('Are you sure you want to delete this habit?')) {
                habits = habits.filter(h => h.id !== editingHabitId);
                Object.keys(completions).forEach(date => {
                    completions[date] = completions[date].filter(id => id !== editingHabitId);
                });
                saveData();
                closeModal();
                renderHabits();
                renderCalendar();
                updateStats();
            }
        }

        function editHabit(event, habitId) {
            event.preventDefault();
            openModal(habitId);
        }

        function changeMonth(delta) {
            calendarMonth.setMonth(calendarMonth.getMonth() + delta);
            renderCalendar();
            updateStats();
        }

        function renderCalendar() {
            const grid = document.getElementById('calendarGrid');
            const monthLabel = document.getElementById('calendarMonth');
            
            const year = calendarMonth.getFullYear();
            const month = calendarMonth.getMonth();
            
            monthLabel.textContent = calendarMonth.toLocaleDateString('en-US', { month: 'long', year: 'numeric' });
            
            const firstDay = new Date(year, month, 1);
            const lastDay = new Date(year, month + 1, 0);
            const startDay = firstDay.getDay();
            
            const days = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
            let html = days.map(d => `<div class="calendar-header">${d}</div>`).join('');
            
            for (let i = 0; i < startDay; i++) {
                html += '<div class="calendar-day empty"></div>';
            }
            
            const today = new Date();
            for (let day = 1; day <= lastDay.getDate(); day++) {
                const date = new Date(year, month, day);
                const dateKey = formatDate(date);
                const completed = completions[dateKey]?.length || 0;
                const total = habits.length;
                const percent = total > 0 ? (completed / total) * 100 : 0;
                
                let dotClass = '';
                if (percent >= 80) dotClass = 'high';
                else if (percent >= 50) dotClass = 'medium';
                else if (percent > 0) dotClass = 'low';
                
                const isToday = date.toDateString() === today.toDateString();
                const isSelected = date.toDateString() === selectedDate.toDateString();
                
                html += `
                    <div class="calendar-day ${isToday ? 'today' : ''} ${isSelected ? 'selected' : ''}" 
                         onclick="selectDate(${year}, ${month}, ${day})">
                        ${day}
                        <div class="completion-dot ${dotClass}"></div>
                    </div>
                `;
            }
            
            grid.innerHTML = html;
        }

        function selectDate(year, month, day) {
            selectedDate = new Date(year, month, day);
            renderDate();
            renderHabits();
            renderCalendar();
        }

        function updateStats() {
            const year = calendarMonth.getFullYear();
            const month = calendarMonth.getMonth();
            const today = new Date();
            
            let totalCompleted = 0;
            let totalPossible = 0;
            let perfectDays = 0;
            
            const habitStats = {};
            habits.forEach(h => {
                habitStats[h.id] = { completed: 0, possible: 0 };
            });
            
            const lastDay = new Date(year, month + 1, 0);
            const daysInMonth = lastDay.getDate();
            const isCurrentMonth = year === today.getFullYear() && month === today.getMonth();
            const countUntilDay = isCurrentMonth ? today.getDate() : daysInMonth;
            
            for (let day = 1; day <= countUntilDay; day++) {
                const date = new Date(year, month, day);
                const dateKey = formatDate(date);
                const dayCompleted = completions[dateKey]?.length || 0;
                
                totalCompleted += dayCompleted;
                totalPossible += habits.length;
                
                if (dayCompleted === habits.length && habits.length > 0) {
                    perfectDays++;
                }
                
                habits.forEach(h => {
                    habitStats[h.id].possible++;
                    if (completions[dateKey]?.includes(h.id)) {
                        habitStats[h.id].completed++;
                    }
                });
            }
            
            let streak = 0;
            let checkDate = new Date(today);
            while (true) {
                const dateKey = formatDate(checkDate);
                const dayCompleted = completions[dateKey]?.length || 0;
                
                if (dayCompleted === habits.length && habits.length > 0) {
                    streak++;
                    checkDate.setDate(checkDate.getDate() - 1);
                } else {
                    break;
                }
            }
            
            document.getElementById('totalCompleted').textContent = totalCompleted;
            document.getElementById('totalPossible').textContent = totalPossible;
            document.getElementById('currentStreak').textContent = streak;
            document.getElementById('perfectDays').textContent = perfectDays;
            
            const percent = totalPossible > 0 ? Math.round((totalCompleted / totalPossible) * 100) : 0;
            document.getElementById('progressPercent').textContent = `${percent}%`;
            document.getElementById('progressFill').style.width = `${percent}%`;
            
            document.getElementById('piePercent').textContent = `${percent}%`;
            const pieChart = document.getElementById('pieChart');
            const completedDeg = (percent / 100) * 360;
            pieChart.style.background = `conic-gradient(
                #00d9ff 0deg,
                #00ff88 ${completedDeg}deg,
                rgba(255,255,255,0.1) ${completedDeg}deg
            )`;
            
            const progressList = document.getElementById('habitProgressList');
            progressList.innerHTML = habits.map(habit => {
                const stats = habitStats[habit.id];
                const habitPercent = stats.possible > 0 ? Math.round((stats.completed / stats.possible) * 100) : 0;
                return `
                    <div class="habit-progress-item">
                        <div class="habit-progress-header">
                            <div class="habit-progress-name">
                                <span>${habit.icon}</span>
                                <span>${habit.name}</span>
                            </div>
                            <span>${stats.completed}/${stats.possible} (${habitPercent}%)</span>
                        </div>
                        <div class="mini-progress-bar">
                            <div class="mini-progress-fill" style="width: ${habitPercent}%"></div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function saveData() {
            localStorage.setItem('habits', JSON.stringify(habits));
            localStorage.setItem('completions', JSON.stringify(completions));
        }

        document.getElementById('modalOverlay').addEventListener('click', function(e) {
            if (e.target === this) closeModal();
        });

        init();
    </script>
</body>
</html>
